# Engagement Setup Script
param (
    [string]$engagementName,
    [string]$engagementType
)

If ($engagementType -eq "Mobile") {
    # Use VBoxManage to import Mobexler VM from ova file
    $virtualMachine = "Mobexler-$engagementName"
    $pathToFile = "C:\Users\Jack Reacher\Downloads\Mobexler.ova"
    VBoxManage import $pathToFile --vsys 0 --eula accept
    VBoxManage modifyvm Mobexler --name $virtualMachine 
}

If ($engagementType -eq "Web") {
    # Use VBoxManage to import Kali VM from ova file
    $fileName = "kali-linux-2023.2-virtualbox-amd64.vbox"
    $virtualMachine = "Kali-$engagementName"
    $pathToFile = "C:\Users\Jack Reacher\Downloads\kali-linux-2023.2-virtualbox-amd64.vbox"
    VBoxManage registervm $pathToFile
    vboxmanage modifyvm $fileName --name $virtualMachine
}

# Create shared folders on host and set to auto-mount on guest
VBoxManage sharedfolder add $virtualMachine --name "SetUpScripts" --hostpath "C:\Users\Jack Reacher\Downloads\VboxShare" --automount
New-Item -Path "C:Engagements\$engagementName" -ItemType Directory
VBoxManage sharedfolder add $virtualMachine --name $engagementName --hostpath "C:Engagements\$engagementName" --automount
# The User Needs to be added to the vboxsf group to have permission to access the shared folder. This is done on Linux by the command sudo adduser $USER vboxsf
