# Define the Python version you want to install
$PythonVersion = "3.9.7"  # Change this to the desired Python version

# Define the Ansible version you want to install
$AnsibleVersion = "4.9.0"  # Change this to the desired Ansible version

# Define the URL to download Python installer
$PythonInstallerUrl = "https://www.python.org/ftp/python/$PythonVersion/python-$PythonVersion-amd64.exe"

# Define the URL to download Ansible
$AnsibleInstallerUrl = "https://github.com/ansible/ansible/archive/v$AnsibleVersion.zip"

# Define the installation paths
$PythonInstallPath = "C:\Python$PythonVersion"
$AnsibleInstallPath = "C:\ansible"

# Function to download and install Python
function InstallPython {
    Write-Host "Downloading Python installer..."
    $PythonInstallerPath = "$env:TEMP\python-$PythonVersion.exe"
    Invoke-WebRequest -Uri $PythonInstallerUrl -OutFile $PythonInstallerPath

    Write-Host "Installing Python $PythonVersion..."
    Start-Process -Wait -FilePath $PythonInstallerPath -ArgumentList "/quiet", "InstallAllUsers=1", "TargetDir=$PythonInstallPath"
}

# Function to install Ansible using pip
function InstallAnsible {
    Write-Host "Installing Ansible..."
    pip install ansible==$AnsibleVersion
}

# Check if Python is already installed
if (Test-Path $PythonInstallPath) {
    Write-Host "Python $PythonVersion is already installed."
}
else {
    InstallPython
}

# Check if Ansible is already installed
if (-Not (Test-Path $AnsibleInstallPath)) {
    # Check if pip is installed, otherwise install it
    if (-Not (Get-Command pip -ErrorAction SilentlyContinue)) {
        Write-Host "Installing pip..."
        (Invoke-WebRequest -Uri https://bootstrap.pypa.io/get-pip.py -UseBasicParsing).Content | python -
    }

    InstallAnsible
}
else {
    Write-Host "Ansible $AnsibleVersion is already installed."
}
